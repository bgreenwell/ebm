<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ebm">
<title>Advanced usage • ebm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced usage">
<meta property="og:description" content="ebm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ebm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ebm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced.html">Advanced usage</a>
    <a class="dropdown-item" href="../articles/interactive.html">Interactive plots</a>
    <a class="dropdown-item" href="../articles/merging.html">Merging models</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Advanced usage</h1>
                        <h4 data-toc-skip class="author">Brandon M.
Greenwell</h4>
            
      
      
      <div class="d-none name"><code>advanced.Rmd</code></div>
    </div>

    
    
<p>In this article, we’ll explore several advanced uses of the
<strong>ebm</strong> package through a binary classification example. In
particular, we’ll be using data from the <a href="https://liacs.leidenuniv.nl/~puttenpwhvander/library/cc2000/" class="external-link">CoIL
2000 Challenge</a>, which are available in the R package <a href="https://cran.r-project.org/package=kernlab" class="external-link">kernlab</a>. The data
set consists of <span class="math inline">\(N = 9822\)</span> customer
records containing 86 variables, including product usage data and
socio-demographic data derived from zip area codes. The goal of the
challenge was to be able to answer the following question: “Can you
predict who would be interested in buying a caravan insurance policy and
give an explanation of why?” Hence, being able to explain your model’s
predictions was key to being successful in this challenge.</p>
<p>We’ll start by loading the data fitting a default EBM classifier:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ebm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load in the data and split into train/test using predefined test set indicator</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ticdata"</span>, package <span class="op">=</span> <span class="st">"kernlab"</span><span class="op">)</span>  <span class="co"># see `?kernlab::ticdata` for details</span></span>
<span><span class="va">ticdata</span><span class="op">$</span><span class="va">CARAVAN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ticdata</span><span class="op">$</span><span class="va">CARAVAN</span> <span class="op">==</span> <span class="st">"insurance"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">tictrn</span> <span class="op">&lt;-</span> <span class="va">ticdata</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5000</span>, <span class="op">]</span></span>
<span><span class="va">tictst</span> <span class="op">&lt;-</span> <span class="va">ticdata</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5000</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Build a default EBM</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebm.html">ebm</a></span><span class="op">(</span><span class="va">CARAVAN</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tictrn</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, n_features <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>  <span class="co"># plot top 15 features based on mean absolute score</span></span></code></pre></div>
<p><img src="advanced_files/figure-html/setup-1.png" width="70%"></p>
<div class="section level2">
<h2 id="monotonic-constraints">Monotonic constraints<a class="anchor" aria-label="anchor" href="#monotonic-constraints"></a>
</h2>
<p>While <code>PPERSAUT</code> (the contribution level for car policies)
is the top predictive feature, it’s also categorical and so we cannot
force monotonicity here. Technically, <code>PPERSAUT</code> is ordinal
so it would not be unreasonable to recode it as an integer or similar
and refit the model (tree-based models tend to only differentiate
between ordered and nominal features). Instead, we’ll focus on the
number of car policies <code>APERSAUT</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, term <span class="op">=</span> <span class="st">"APERSAUT"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_files/figure-html/ebm-term-APERSAUT-1.png" width="70%"></p>
<p>Here we can see that the relationship is mostly decreasing, which
seems logical. The more car policies they already own, the less likely
they are to purchase another. Hence, it may make sense to force
decreasing monotonicity here. While we can force monotonic constraints
via the <code>monotone_constraints</code> argument in the call to
<code><a href="../reference/ebm.html">ebm()</a></code>, the original authors generally recommend forcing
monotonicity by post-processing the graphs instead using isotonic
regression. This can be done by calling the <code>$monotonize()</code>
method on the fitted EBM object. This is the recommended approach as it
prevents the model from compensating for the monotonicity constraints by
learning non-monotonic effects in other highly-correlated features.</p>
<p>In the example below, we post-process the graph for
<code>APERDAUT</code> to force negative monotonicity
(<code>increasing = FALSE</code>) using isotonic regression. Notice this
does change the term contributions for <code>APERSAUT</code> in the
fitted model. Additionally, we lose any uncertainty associated with the
feature from the outer bagging in the original model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="fu">monotonize</span><span class="op">(</span><span class="st">"APERSAUT"</span>, increasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ExplainableBoostingClassifier(early_stopping_tolerance=0,</span></span>
<span><span class="co">#&gt;                               interaction_smoothing_rounds=100,</span></span>
<span><span class="co">#&gt;                               learning_rate=0.04, max_leaves=2, min_hessian=0.0,</span></span>
<span><span class="co">#&gt;                               smoothing_rounds=500)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, term <span class="op">=</span> <span class="st">"APERSAUT"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_files/figure-html/ebm-term-APERSAUT-monotonize-1.png" width="70%"></p>
<p>While the <strong>ebm</strong> package does not expose 100% of the
functionality available in Python, this example shows that you can
pretty much do anything you need by interacting directly with the
underlying Python objects (the magic happens through <a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a>). For
example, to reproduce the original HTML-based visualization, which will
be displayed in a browser, you can do the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">term_names_</span> <span class="op">==</span> <span class="st">"APERSAUT"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span> </span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="fu">explain_global</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">visualize</span><span class="op">(</span><span class="va">idx</span><span class="op">)</span></span>
<span><span class="va">plt</span><span class="op">$</span><span class="fu">show</span><span class="op">(</span><span class="op">)</span>  <span class="co"># should open in a browser; can also call `plt$write_html("&lt;path/to/file.html&gt;")`</span></span></code></pre></div>
<p>Details aside, you can access the data to recreate the plot (like the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method does), by coercing the internal Python plotly
object to an ordered dictionary which <strong>reticulate</strong> will
automatically convert to a list. For instance, the following snippet of
code extracts the main data used in generating the previous plot.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span><span class="op">$</span><span class="fu">to_ordered_dict</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; $fill</span></span>
<span><span class="co">#&gt; [1] "none"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fillcolor</span></span>
<span><span class="co">#&gt; [1] "rgba(68, 68, 68, 0.15)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $line</span></span>
<span><span class="co">#&gt; $line$color</span></span>
<span><span class="co">#&gt; [1] "rgb(31, 119, 180)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $line$shape</span></span>
<span><span class="co">#&gt; [1] "hv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mode</span></span>
<span><span class="co">#&gt; [1] "lines"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "Main"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $type</span></span>
<span><span class="co">#&gt; [1] "scatter"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $x</span></span>
<span><span class="co">#&gt; [1] 0.0 0.5 1.5 2.5 3.5 5.0 6.5 7.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $xaxis</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $y</span></span>
<span><span class="co">#&gt; [1]  0.0003276259  0.0003276259  0.0003276259  0.0003276259 -0.1000587645</span></span>
<span><span class="co">#&gt; [6] -0.3973416956 -0.7382006285 -0.7382006285</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $yaxis</span></span>
<span><span class="co">#&gt; [1] "y"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-compression-via-the-lasso">Model compression via the LASSO<a class="anchor" aria-label="anchor" href="#model-compression-via-the-lasso"></a>
</h2>
<p>Compared to “black-box” models, like random forests and deep neural
networks, EBMs are considered “glass-box” models that can be
competitively accurate while also maintaining a higher degree of
transparency and explainability. However, EBMs become readily less
transparent and harder to interpret in high-dimensional settings with
many predictor variables; they also become more difficult to use in
production due to increases in scoring time. We propose a simple
solution based on the least absolute shrinkage and selection operator
(LASSO) that can help introduce sparsity by reweighting the individual
model terms and removing the less relevant ones, thereby allowing these
models to maintain their transparency and relatively fast scoring times
in higher-dimensional settings. In short, post-processing a fitted EBM
with many (i.e., possibly hundreds or thousands) of terms using the
LASSO can help reduce the model’s complexity and drastically improve
scoring time. For methodological (and software) details, see the
associated paper on “<a href="https://arxiv.org/abs/2311.07452" class="external-link">Explainable Boosting Machines
with Sparsity—Maintaining Explainability in High-Dimensional
Settings</a>.”</p>
<p>We’ll illustrate the basic idea using the previous model, which
contains 1 total terms comprised of the main effects, pairwise
interactions, and an intercept.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rebuild the previous EBM without monotonicity</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebm.html">ebm</a></span><span class="op">(</span><span class="va">CARAVAN</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tictrn</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">term_names_</span>  <span class="co"># does not include the intercept</span></span>
<span><span class="co">#&gt;   [1] "STYPE"               "MAANTHUI"            "MGEMOMV"            </span></span>
<span><span class="co">#&gt;   [4] "MGEMLEEF"            "MOSHOOFD"            "MGODRK"             </span></span>
<span><span class="co">#&gt;   [7] "MGODPR"              "MGODOV"              "MGODGE"             </span></span>
<span><span class="co">#&gt;  [10] "MRELGE"              "MRELSA"              "MRELOV"             </span></span>
<span><span class="co">#&gt;  [13] "MFALLEEN"            "MFGEKIND"            "MFWEKIND"           </span></span>
<span><span class="co">#&gt;  [16] "MOPLHOOG"            "MOPLMIDD"            "MOPLLAAG"           </span></span>
<span><span class="co">#&gt;  [19] "MBERHOOG"            "MBERZELF"            "MBERBOER"           </span></span>
<span><span class="co">#&gt;  [22] "MBERMIDD"            "MBERARBG"            "MBERARBO"           </span></span>
<span><span class="co">#&gt;  [25] "MSKA"                "MSKB1"               "MSKB2"              </span></span>
<span><span class="co">#&gt;  [28] "MSKC"                "MSKD"                "MHHUUR"             </span></span>
<span><span class="co">#&gt;  [31] "MHKOOP"              "MAUT1"               "MAUT2"              </span></span>
<span><span class="co">#&gt;  [34] "MAUT0"               "MZFONDS"             "MZPART"             </span></span>
<span><span class="co">#&gt;  [37] "MINKM30"             "MINK3045"            "MINK4575"           </span></span>
<span><span class="co">#&gt;  [40] "MINK7512"            "MINK123M"            "MINKGEM"            </span></span>
<span><span class="co">#&gt;  [43] "MKOOPKLA"            "PWAPART"             "PWABEDR"            </span></span>
<span><span class="co">#&gt;  [46] "PWALAND"             "PPERSAUT"            "PBESAUT"            </span></span>
<span><span class="co">#&gt;  [49] "PMOTSCO"             "AAUT"                "PAANHANG"           </span></span>
<span><span class="co">#&gt;  [52] "PTRACTOR"            "PWERKT"              "PBROM"              </span></span>
<span><span class="co">#&gt;  [55] "PLEVEN"              "PPERSONG"            "PGEZONG"            </span></span>
<span><span class="co">#&gt;  [58] "PWAOREG"             "PBRAND"              "PZEILPL"            </span></span>
<span><span class="co">#&gt;  [61] "PPLEZIER"            "PFIETS"              "PINBOED"            </span></span>
<span><span class="co">#&gt;  [64] "PBYSTAND"            "AWAPART"             "AWABEDR"            </span></span>
<span><span class="co">#&gt;  [67] "AWALAND"             "APERSAUT"            "ABESAUT"            </span></span>
<span><span class="co">#&gt;  [70] "AMOTSCO"             "AVRAAUT"             "AAANHANG"           </span></span>
<span><span class="co">#&gt;  [73] "ATRACTOR"            "AWERKT"              "ABROM"              </span></span>
<span><span class="co">#&gt;  [76] "ALEVEN"              "APERSONG"            "AGEZONG"            </span></span>
<span><span class="co">#&gt;  [79] "AWAOREG"             "ABRAND"              "AZEILPL"            </span></span>
<span><span class="co">#&gt;  [82] "APLEZIER"            "AFIETS"              "AINBOED"            </span></span>
<span><span class="co">#&gt;  [85] "ABYSTAND"            "STYPE &amp; PPERSAUT"    "STYPE &amp; PPLEZIER"   </span></span>
<span><span class="co">#&gt;  [88] "STYPE &amp; APERSAUT"    "STYPE &amp; APLEZIER"    "MAANTHUI &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt;  [91] "MGEMOMV &amp; PPERSAUT"  "MGEMLEEF &amp; PPERSAUT" "MOSHOOFD &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt;  [94] "MGODRK &amp; PPERSAUT"   "MGODPR &amp; PPERSAUT"   "MGODOV &amp; PPERSAUT"  </span></span>
<span><span class="co">#&gt;  [97] "MGODGE &amp; PPERSAUT"   "MRELGE &amp; PPERSAUT"   "MRELGE &amp; PBRAND"    </span></span>
<span><span class="co">#&gt; [100] "MRELSA &amp; PPERSAUT"   "MRELOV &amp; PPERSAUT"   "MFALLEEN &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [103] "MFGEKIND &amp; PPERSAUT" "MFWEKIND &amp; PPERSAUT" "MOPLHOOG &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [106] "MOPLMIDD &amp; PPERSAUT" "MOPLLAAG &amp; PPERSAUT" "MBERHOOG &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [109] "MBERBOER &amp; PPERSAUT" "MBERMIDD &amp; PPERSAUT" "MBERMIDD &amp; PBRAND"  </span></span>
<span><span class="co">#&gt; [112] "MBERARBG &amp; PPERSAUT" "MBERARBG &amp; PBRAND"   "MBERARBO &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [115] "MSKA &amp; PPERSAUT"     "MSKB1 &amp; PPERSAUT"    "MSKB1 &amp; PBRAND"     </span></span>
<span><span class="co">#&gt; [118] "MSKB2 &amp; PPERSAUT"    "MSKC &amp; PPERSAUT"     "MSKD &amp; PPERSAUT"    </span></span>
<span><span class="co">#&gt; [121] "MHHUUR &amp; PPERSAUT"   "MHHUUR &amp; PBRAND"     "MHKOOP &amp; PPERSAUT"  </span></span>
<span><span class="co">#&gt; [124] "MHKOOP &amp; PBRAND"     "MAUT1 &amp; PPERSAUT"    "MAUT2 &amp; PPERSAUT"   </span></span>
<span><span class="co">#&gt; [127] "MAUT0 &amp; PPERSAUT"    "MZFONDS &amp; PPERSAUT"  "MZPART &amp; PPERSAUT"  </span></span>
<span><span class="co">#&gt; [130] "MINKM30 &amp; PPERSAUT"  "MINKM30 &amp; PTRACTOR"  "MINK3045 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [133] "MINK4575 &amp; PPERSAUT" "MINK7512 &amp; PPERSAUT" "MINK123M &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [136] "MINKGEM &amp; PPERSAUT"  "MKOOPKLA &amp; PPERSAUT" "MKOOPKLA &amp; PPLEZIER"</span></span>
<span><span class="co">#&gt; [139] "MKOOPKLA &amp; APLEZIER" "PWAPART &amp; PPERSAUT"  "PWABEDR &amp; PTRACTOR" </span></span>
<span><span class="co">#&gt; [142] "PWALAND &amp; PPERSAUT"  "PPERSAUT &amp; PMOTSCO"  "PPERSAUT &amp; PAANHANG"</span></span>
<span><span class="co">#&gt; [145] "PPERSAUT &amp; PTRACTOR" "PPERSAUT &amp; PBROM"    "PPERSAUT &amp; PLEVEN"  </span></span>
<span><span class="co">#&gt; [148] "PPERSAUT &amp; PGEZONG"  "PPERSAUT &amp; PBRAND"   "PPERSAUT &amp; PPLEZIER"</span></span>
<span><span class="co">#&gt; [151] "PPERSAUT &amp; PFIETS"   "PPERSAUT &amp; PINBOED"  "PPERSAUT &amp; PBYSTAND"</span></span>
<span><span class="co">#&gt; [154] "PPERSAUT &amp; AAANHANG" "PPERSAUT &amp; ABROM"    "PPERSAUT &amp; ALEVEN"  </span></span>
<span><span class="co">#&gt; [157] "PPERSAUT &amp; AGEZONG"  "PPERSAUT &amp; ABRAND"   "PPERSAUT &amp; APLEZIER"</span></span>
<span><span class="co">#&gt; [160] "PPERSAUT &amp; AFIETS"   "PBROM &amp; APERSAUT"    "APERSAUT &amp; ABROM"</span></span></code></pre></div>
<p>To make things easier downstream, lets go ahead partition the data by
separating the features from the response:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_trn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tictrn</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">CARAVAN</span><span class="op">)</span>  <span class="co"># feature columns</span></span>
<span><span class="va">X_tst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tictst</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">CARAVAN</span><span class="op">)</span></span>
<span><span class="va">y_trn</span> <span class="op">&lt;-</span> <span class="va">tictrn</span><span class="op">$</span><span class="va">CARAVAN</span></span>
<span><span class="va">y_tst</span> <span class="op">&lt;-</span> <span class="va">tictst</span><span class="op">$</span><span class="va">CARAVAN</span></span></code></pre></div>
<p>In the next chunk, we’ll construct a data matrix of the individual
term contributions for both the train and test sets. That is, each is a
matrix who’s <span class="math inline">\(i\)</span>-th column is given
by the <span class="math inline">\(i\)</span>-th terms contribution to
the model’s output (before applying any link function, so it’ll be on
the logit scale in this example). In particular, note that
<code>rowSum(terms_trn) + fit$intercept_</code> is equivalent to calling
<code>predict(fit, newdata = X_trn)</code>. These data matrices will be
used as input to the LASSO shortly after.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">terms_trn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">X_trn</span>, type <span class="op">=</span> <span class="st">"terms"</span><span class="op">)</span></span>
<span><span class="va">terms_tst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">X_tst</span>, type <span class="op">=</span> <span class="st">"terms"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">terms_trn</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">terms_tst</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">term_names_</span></span>
<span></span>
<span><span class="co"># Sanity check</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">terms_trn</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">intercept_</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">tictrn</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span>  <span class="co"># additive on link scale</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,] -2.436647 -2.436647</span></span>
<span><span class="co">#&gt; [2,] -3.750533 -3.750533</span></span>
<span><span class="co">#&gt; [3,] -2.470428 -2.470428</span></span>
<span><span class="co">#&gt; [4,] -2.345187 -2.345187</span></span>
<span><span class="co">#&gt; [5,] -6.122288 -6.122288</span></span>
<span><span class="co">#&gt; [6,] -5.021766 -5.021766</span></span></code></pre></div>
<p>Next, we use the <a href="https://cran.r-project.org/package=glmnet" class="external-link">glmnet</a> package to
fit the LASSO path to the new data set comprised of the individual term
contributions. We then assess performance using the associated test set
and collect the results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the LASSO regularization path using the term contributions as inputs</span></span>
<span><span class="va">ebm_lasso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">terms_trn</span>,        <span class="co"># individual term contributions/scores</span></span>
<span>  y <span class="op">=</span> <span class="va">y_trn</span>,            <span class="co"># original response variable</span></span>
<span>  lower.limits <span class="op">=</span> <span class="fl">0</span>,     <span class="co"># coefficients should be strictly positive</span></span>
<span>  standardize <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># no need to standardize</span></span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>   <span class="co"># logistic regression</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assess performance of fit using an independent test set</span></span>
<span><span class="va">perf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/assess.glmnet.html" class="external-link">assess.glmnet</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">ebm_lasso</span>,  <span class="co"># fitted LASSO model</span></span>
<span>  newx <span class="op">=</span> <span class="va">terms_tst</span>,    <span class="co"># test set contributions</span></span>
<span>  newy <span class="op">=</span> <span class="va">y_tst</span>,        <span class="co"># same response variable (test set)</span></span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>  <span class="co"># for logit link (i.e., logistic regression)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">perf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, args <span class="op">=</span> <span class="va">perf</span><span class="op">)</span>  <span class="co"># bind results into matrix</span></span>
<span></span>
<span><span class="co"># Data frame of results (one row for each value of lambda)</span></span>
<span><span class="va">ebm_lasso_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"num_terms"</span> <span class="op">=</span> <span class="va">ebm_lasso</span><span class="op">$</span><span class="va">df</span>,  <span class="co"># number of non-zero coefficients for each lambda</span></span>
<span>  <span class="va">perf</span>,                        <span class="co"># performance metrics (i.e., deviance, auc, etc.)</span></span>
<span>  <span class="st">"lambda"</span> <span class="op">=</span> <span class="va">ebm_lasso</span><span class="op">$</span><span class="va">lambda</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sort in ascending order of number of terms</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ebm_lasso_res</span> <span class="op">&lt;-</span> <span class="va">ebm_lasso_res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">ebm_lasso_res</span><span class="op">$</span><span class="va">num_terms</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    num_terms  deviance      class       auc       mse       mae      lambda</span></span>
<span><span class="co">#&gt; s0         0 0.4593780 0.06097055 0.5000000 0.1145195 0.2244984 0.010485360</span></span>
<span><span class="co">#&gt; s1         1 0.4558854 0.06097055 0.6585024 0.1141333 0.2241294 0.009553870</span></span>
<span><span class="co">#&gt; s2         1 0.4530105 0.06097055 0.6585024 0.1138124 0.2237924 0.008705130</span></span>
<span><span class="co">#&gt; s3         1 0.4506381 0.06097055 0.6585024 0.1135459 0.2234846 0.007931790</span></span>
<span><span class="co">#&gt; s4         1 0.4486776 0.06097055 0.6585024 0.1133243 0.2232036 0.007227152</span></span>
<span><span class="co">#&gt; s5         1 0.4470567 0.06097055 0.6585024 0.1131402 0.2229470 0.006585112</span></span></code></pre></div>
<p>Next, we’ll compute the <code>lambda</code> value associated with the
smallest deviance (or half the log-loss):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">ebm_lasso_res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">ebm_lasso_res</span><span class="op">$</span><span class="va">deviance</span><span class="op">)</span>, <span class="st">"lambda"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0004434513</span></span></code></pre></div>
<p>Here are the results for the compressed EBM corresponding to this
value of <code>lambda</code>:</p>
<p><code>{rebm-ticdata-lasso-results} ebm_lasso_results[which.min(ebm_lasso_results$deviance), ]</code></p>
<p>Finally, we can plot the results! On the left, we show the LASSO path
and on the right we show the test deviance as a function of the number
of terms in the compressed model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, cex.lab <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>    cex.axis <span class="op">=</span> <span class="fl">0.8</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.7</span>, <span class="fl">0</span><span class="op">)</span>, tcl <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette</a></span><span class="op">(</span><span class="st">"Okabe-Ito"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ebm_lasso</span>, xvar <span class="op">=</span> <span class="st">"lambda"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="fl">3</span>, alpha.f <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ebm_lasso_res</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"num_terms"</span>, <span class="st">"deviance"</span><span class="op">)</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Number of terms"</span>, ylab <span class="op">=</span> <span class="st">"Test deviance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_files/figure-html/ebm-ticdata-lassso-plot-1.png" width="70%"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette</a></span><span class="op">(</span><span class="st">"default"</span><span class="op">)</span></span></code></pre></div>
<p>Lastly, we can call the <code>$scale()</code> and
<code>$sweep()</code> methods to reweight and purge any unused terms
from the model:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ebm_lasso</span>, s <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span>, nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">weights</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span>  <span class="co"># Sigh, Python indexing starts at 0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Replcating term "</span>, <span class="va">fit</span><span class="op">$</span><span class="va">term_names_</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">" with "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">fit</span><span class="op">$</span><span class="fu">scale</span><span class="op">(</span><span class="va">idx</span>, factor <span class="op">=</span> <span class="va">weights</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "Replcating term STYPE with STYPE"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAANTHUI with MAANTHUI"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGEMOMV with MGEMOMV"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGEMLEEF with MGEMLEEF"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOSHOOFD with MOSHOOFD"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODRK with MGODRK"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODPR with MGODPR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODOV with MGODOV"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODGE with MGODGE"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MRELGE with MRELGE"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MRELSA with MRELSA"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MRELOV with MRELOV"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MFALLEEN with MFALLEEN"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MFGEKIND with MFGEKIND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MFWEKIND with MFWEKIND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOPLHOOG with MOPLHOOG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOPLMIDD with MOPLMIDD"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOPLLAAG with MOPLLAAG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERHOOG with MBERHOOG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERZELF with MBERZELF"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERBOER with MBERBOER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERMIDD with MBERMIDD"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERARBG with MBERARBG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERARBO with MBERARBO"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKA with MSKA"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKB1 with MSKB1"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKB2 with MSKB2"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKC with MSKC"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKD with MSKD"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MHHUUR with MHHUUR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MHKOOP with MHKOOP"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAUT1 with MAUT1"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAUT2 with MAUT2"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAUT0 with MAUT0"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MZFONDS with MZFONDS"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MZPART with MZPART"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINKM30 with MINKM30"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK3045 with MINK3045"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK4575 with MINK4575"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK7512 with MINK7512"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK123M with MINK123M"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINKGEM with MINKGEM"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MKOOPKLA with MKOOPKLA"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWAPART with PWAPART"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWABEDR with PWABEDR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWALAND with PWALAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT with PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PBESAUT with PBESAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PMOTSCO with PMOTSCO"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AAUT with AAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PAANHANG with PAANHANG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PTRACTOR with PTRACTOR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWERKT with PWERKT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PBROM with PBROM"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PLEVEN with PLEVEN"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSONG with PPERSONG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PGEZONG with PGEZONG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWAOREG with PWAOREG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PBRAND with PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PZEILPL with PZEILPL"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPLEZIER with PPLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PFIETS with PFIETS"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PINBOED with PINBOED"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PBYSTAND with PBYSTAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AWAPART with AWAPART"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AWABEDR with AWABEDR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AWALAND with AWALAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term APERSAUT with APERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term ABESAUT with ABESAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AMOTSCO with AMOTSCO"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AVRAAUT with AVRAAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AAANHANG with AAANHANG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term ATRACTOR with ATRACTOR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AWERKT with AWERKT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term ABROM with ABROM"</span></span>
<span><span class="co">#&gt; [1] "Replcating term ALEVEN with ALEVEN"</span></span>
<span><span class="co">#&gt; [1] "Replcating term APERSONG with APERSONG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AGEZONG with AGEZONG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AWAOREG with AWAOREG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term ABRAND with ABRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AZEILPL with AZEILPL"</span></span>
<span><span class="co">#&gt; [1] "Replcating term APLEZIER with APLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AFIETS with AFIETS"</span></span>
<span><span class="co">#&gt; [1] "Replcating term AINBOED with AINBOED"</span></span>
<span><span class="co">#&gt; [1] "Replcating term ABYSTAND with ABYSTAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term STYPE &amp; PPERSAUT with STYPE &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term STYPE &amp; PPLEZIER with STYPE &amp; PPLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term STYPE &amp; APERSAUT with STYPE &amp; APERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term STYPE &amp; APLEZIER with STYPE &amp; APLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAANTHUI &amp; PPERSAUT with MAANTHUI &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGEMOMV &amp; PPERSAUT with MGEMOMV &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGEMLEEF &amp; PPERSAUT with MGEMLEEF &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOSHOOFD &amp; PPERSAUT with MOSHOOFD &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODRK &amp; PPERSAUT with MGODRK &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODPR &amp; PPERSAUT with MGODPR &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODOV &amp; PPERSAUT with MGODOV &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MGODGE &amp; PPERSAUT with MGODGE &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MRELGE &amp; PPERSAUT with MRELGE &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MRELGE &amp; PBRAND with MRELGE &amp; PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MRELSA &amp; PPERSAUT with MRELSA &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MRELOV &amp; PPERSAUT with MRELOV &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MFALLEEN &amp; PPERSAUT with MFALLEEN &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MFGEKIND &amp; PPERSAUT with MFGEKIND &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MFWEKIND &amp; PPERSAUT with MFWEKIND &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOPLHOOG &amp; PPERSAUT with MOPLHOOG &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOPLMIDD &amp; PPERSAUT with MOPLMIDD &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MOPLLAAG &amp; PPERSAUT with MOPLLAAG &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERHOOG &amp; PPERSAUT with MBERHOOG &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERBOER &amp; PPERSAUT with MBERBOER &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERMIDD &amp; PPERSAUT with MBERMIDD &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERMIDD &amp; PBRAND with MBERMIDD &amp; PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERARBG &amp; PPERSAUT with MBERARBG &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERARBG &amp; PBRAND with MBERARBG &amp; PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MBERARBO &amp; PPERSAUT with MBERARBO &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKA &amp; PPERSAUT with MSKA &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKB1 &amp; PPERSAUT with MSKB1 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKB1 &amp; PBRAND with MSKB1 &amp; PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKB2 &amp; PPERSAUT with MSKB2 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKC &amp; PPERSAUT with MSKC &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MSKD &amp; PPERSAUT with MSKD &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MHHUUR &amp; PPERSAUT with MHHUUR &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MHHUUR &amp; PBRAND with MHHUUR &amp; PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MHKOOP &amp; PPERSAUT with MHKOOP &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MHKOOP &amp; PBRAND with MHKOOP &amp; PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAUT1 &amp; PPERSAUT with MAUT1 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAUT2 &amp; PPERSAUT with MAUT2 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MAUT0 &amp; PPERSAUT with MAUT0 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MZFONDS &amp; PPERSAUT with MZFONDS &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MZPART &amp; PPERSAUT with MZPART &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINKM30 &amp; PPERSAUT with MINKM30 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINKM30 &amp; PTRACTOR with MINKM30 &amp; PTRACTOR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK3045 &amp; PPERSAUT with MINK3045 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK4575 &amp; PPERSAUT with MINK4575 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK7512 &amp; PPERSAUT with MINK7512 &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINK123M &amp; PPERSAUT with MINK123M &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MINKGEM &amp; PPERSAUT with MINKGEM &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MKOOPKLA &amp; PPERSAUT with MKOOPKLA &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MKOOPKLA &amp; PPLEZIER with MKOOPKLA &amp; PPLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term MKOOPKLA &amp; APLEZIER with MKOOPKLA &amp; APLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWAPART &amp; PPERSAUT with PWAPART &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWABEDR &amp; PTRACTOR with PWABEDR &amp; PTRACTOR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PWALAND &amp; PPERSAUT with PWALAND &amp; PPERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PMOTSCO with PPERSAUT &amp; PMOTSCO"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PAANHANG with PPERSAUT &amp; PAANHANG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PTRACTOR with PPERSAUT &amp; PTRACTOR"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PBROM with PPERSAUT &amp; PBROM"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PLEVEN with PPERSAUT &amp; PLEVEN"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PGEZONG with PPERSAUT &amp; PGEZONG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PBRAND with PPERSAUT &amp; PBRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PPLEZIER with PPERSAUT &amp; PPLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PFIETS with PPERSAUT &amp; PFIETS"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PINBOED with PPERSAUT &amp; PINBOED"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; PBYSTAND with PPERSAUT &amp; PBYSTAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; AAANHANG with PPERSAUT &amp; AAANHANG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; ABROM with PPERSAUT &amp; ABROM"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; ALEVEN with PPERSAUT &amp; ALEVEN"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; AGEZONG with PPERSAUT &amp; AGEZONG"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; ABRAND with PPERSAUT &amp; ABRAND"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; APLEZIER with PPERSAUT &amp; APLEZIER"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PPERSAUT &amp; AFIETS with PPERSAUT &amp; AFIETS"</span></span>
<span><span class="co">#&gt; [1] "Replcating term PBROM &amp; APERSAUT with PBROM &amp; APERSAUT"</span></span>
<span><span class="co">#&gt; [1] "Replcating term APERSAUT &amp; ABROM with APERSAUT &amp; ABROM"</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">intercept_</span> <span class="op">&lt;-</span> <span class="va">weights</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove unused terms!</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="fu">sweep</span><span class="op">(</span>terms <span class="op">=</span> <span class="cn">TRUE</span>, bins <span class="op">=</span> <span class="cn">TRUE</span>, features <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ExplainableBoostingClassifier(early_stopping_tolerance=0,</span></span>
<span><span class="co">#&gt;                               interaction_smoothing_rounds=100,</span></span>
<span><span class="co">#&gt;                               learning_rate=0.04, max_leaves=2, min_hessian=0.0,</span></span>
<span><span class="co">#&gt;                               smoothing_rounds=500)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">term_names_</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 27</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>  <span class="co"># show new feature importance scores</span></span></code></pre></div>
<p><img src="advanced_files/figure-html/ebm-ticdata-lasso-scale-1.png" width="70%"></p>
<p>And just as a sanity check, we can see that the compressed (i.e.,
reduced) model does produce the right predictions. An ROC curve via the
<a href="https://cran.r-project.org/package=pROC" class="external-link">pROC</a> is also
constructed and shown below.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare predictions to LASSO fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">X_tst</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]        [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.9790247 0.020975310</span></span>
<span><span class="co">#&gt; [2,] 0.9819993 0.018000657</span></span>
<span><span class="co">#&gt; [3,] 0.9907643 0.009235741</span></span>
<span><span class="co">#&gt; [4,] 0.9098090 0.090190968</span></span>
<span><span class="co">#&gt; [5,] 0.9531169 0.046883138</span></span>
<span><span class="co">#&gt; [6,] 0.9443282 0.055671789</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ebm_lasso</span>, <span class="va">terms_tst</span>, s <span class="op">=</span> <span class="va">lambda</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               s1</span></span>
<span><span class="co">#&gt; [1,] 0.020975310</span></span>
<span><span class="co">#&gt; [2,] 0.018000657</span></span>
<span><span class="co">#&gt; [3,] 0.009235741</span></span>
<span><span class="co">#&gt; [4,] 0.090190968</span></span>
<span><span class="co">#&gt; [5,] 0.046883138</span></span>
<span><span class="co">#&gt; [6,] 0.055671789</span></span>
<span></span>
<span><span class="co"># ROC curve and AUROC statistic</span></span>
<span><span class="op">(</span><span class="va">roc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">y_tst</span>, predictor <span class="op">=</span> <span class="va">p</span><span class="op">[</span>, <span class="fl">2L</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Setting levels: control = 0, case = 1</span></span>
<span><span class="co">#&gt; Setting direction: controls &lt; cases</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; roc.default(response = y_tst, predictor = p[, 2L])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data: p[, 2] in 4528 controls (y_tst 0) &lt; 294 cases (y_tst 1).</span></span>
<span><span class="co">#&gt; Area under the curve: 0.735</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roc</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_files/figure-html/unnamed-chunk-2-1.png" width="70%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brandon Greenwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
